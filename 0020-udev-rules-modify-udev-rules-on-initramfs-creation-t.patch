From 4f6e29330818f05742141a135e521be001f6e6b7 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Fri, 8 Feb 2013 14:15:11 +0100
Subject: [PATCH] udev-rules: modify udev rules on initramfs creation time

---
 modules.d/95udev-rules/module-setup.sh       | 2 +-
 modules.d/95udev-rules/udev-rules-prepare.sh | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/modules.d/95udev-rules/module-setup.sh b/modules.d/95udev-rules/module-setup.sh
index 54a192e..f56f166 100755
--- a/modules.d/95udev-rules/module-setup.sh
+++ b/modules.d/95udev-rules/module-setup.sh
@@ -75,6 +75,6 @@ install() {
 
     inst_libdir_file "libnss_files*"
 
-    inst_hook pre-udev 10 "$moddir/udev-rules-prepare.sh"
+    . "$moddir/udev-rules-prepare.sh"
 }
 
diff --git a/modules.d/95udev-rules/udev-rules-prepare.sh b/modules.d/95udev-rules/udev-rules-prepare.sh
index 4beefda..920485d 100644
--- a/modules.d/95udev-rules/udev-rules-prepare.sh
+++ b/modules.d/95udev-rules/udev-rules-prepare.sh
@@ -4,7 +4,7 @@
 
 [ -z "$UDEVVERSION" ] && export UDEVVERSION=$(udevadm --version)
 
-for f in /etc/udev/rules.d/*-persistent-storage.rules; do
+for f in ${initdir}/etc/udev/rules.d/*-persistent-storage.rules; do
     [ -e "$f" ] || continue
     while read line; do
         if [ "${line%%IMPORT PATH_ID}" != "$line" ]; then
