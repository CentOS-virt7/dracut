From e26d76dca1ffded7fb319b66d03e50ef9d906e4f Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Tue, 19 Mar 2013 12:22:33 +0100
Subject: [PATCH] systemd: add more ordering

---
 modules.d/98systemd/dracut-mount.service     | 3 +--
 modules.d/98systemd/dracut-pre-mount.service | 2 +-
 modules.d/98systemd/dracut-pre-pivot.service | 4 ++--
 modules.d/98systemd/module-setup.sh          | 2 +-
 4 files changed, 5 insertions(+), 6 deletions(-)

diff --git a/modules.d/98systemd/dracut-mount.service b/modules.d/98systemd/dracut-mount.service
index 5c12683..db18f86 100644
--- a/modules.d/98systemd/dracut-mount.service
+++ b/modules.d/98systemd/dracut-mount.service
@@ -10,9 +10,8 @@
 [Unit]
 Description=dracut mount hook
 Documentation=man:dracut-mount.service(8)
-DefaultDependencies=no
 After=initrd-root-fs.target initrd-parse-etc.service
-
+After=dracut-initqueue.service dracut-pre-mount.service
 ConditionPathExists=/etc/initrd-release
 ConditionDirectoryNotEmpty=|/lib/dracut/hooks/mount
 ConditionKernelCommandLine=|rd.break=mount
diff --git a/modules.d/98systemd/dracut-pre-mount.service b/modules.d/98systemd/dracut-pre-mount.service
index 0d76943..bec3c75 100644
--- a/modules.d/98systemd/dracut-pre-mount.service
+++ b/modules.d/98systemd/dracut-pre-mount.service
@@ -11,7 +11,7 @@
 Description=dracut pre-mount hook
 Documentation=man:dracut-pre-mount.service(8)
 DefaultDependencies=no
-Before=initrd-root-fs.target
+Before=initrd-root-fs.target sysroot.mount
 After=dracut-initqueue.service
 After=cryptsetup.target
 ConditionPathExists=/etc/initrd-release
diff --git a/modules.d/98systemd/dracut-pre-pivot.service b/modules.d/98systemd/dracut-pre-pivot.service
index 72941c9..9d0143c 100644
--- a/modules.d/98systemd/dracut-pre-pivot.service
+++ b/modules.d/98systemd/dracut-pre-pivot.service
@@ -10,8 +10,8 @@
 [Unit]
 Description=dracut pre-pivot and cleanup hook
 Documentation=man:dracut-pre-pivot.service(8)
-DefaultDependencies=no
-After=initrd-fs.target
+After=initrd.target initrd-parse-etc.service
+After=dracut-initqueue.service dracut-pre-mount.service dracut-mount.service
 Before=initrd-cleanup.service
 ConditionPathExists=/etc/initrd-release
 ConditionDirectoryNotEmpty=|/lib/dracut/hooks/pre-pivot
diff --git a/modules.d/98systemd/module-setup.sh b/modules.d/98systemd/module-setup.sh
index 17dbc44..252074f 100755
--- a/modules.d/98systemd/module-setup.sh
+++ b/modules.d/98systemd/module-setup.sh
@@ -25,7 +25,7 @@ install() {
 #    fi
 
     if strstr "$prefix" "/run/"; then
-        dfatal "systemd does not work a prefix, which contains \"/run\"!!"
+        dfatal "systemd does not work with a prefix, which contains \"/run\"!!"
         exit 1
     fi
 
