From a0be1eddcf8cfc74d3475965f4bba351653870a8 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Thu, 27 Sep 2012 11:52:27 +0200
Subject: [PATCH] network/ifup.sh: setup nameserver for every interface

even for dhcp

https://bugzilla.redhat.com/show_bug.cgi?id=840769
---
 modules.d/40network/ifup.sh | 22 ++++++++--------------
 1 file changed, 8 insertions(+), 14 deletions(-)

diff --git a/modules.d/40network/ifup.sh b/modules.d/40network/ifup.sh
index 316a21a..95289c9 100755
--- a/modules.d/40network/ifup.sh
+++ b/modules.d/40network/ifup.sh
@@ -88,13 +88,6 @@ do_ipv6auto() {
     wait_for_if_up $netif
 
     [ -n "$hostname" ] && echo "echo $hostname > /proc/sys/kernel/hostname" > /tmp/net.$netif.hostname
-
-    namesrv=$(getargs nameserver)
-    if  [ -n "$namesrv" ] ; then
-        for s in $namesrv; do
-            echo nameserver $s
-        done
-    fi >> /tmp/net.$netif.resolv.conf
 }
 
 # Handle static ip configuration
@@ -115,13 +108,6 @@ do_static() {
 
     [ -n "$gw" ] && echo ip route add default via $gw dev $netif > /tmp/net.$netif.gw
     [ -n "$hostname" ] && echo "echo $hostname > /proc/sys/kernel/hostname" > /tmp/net.$netif.hostname
-
-    namesrv=$(getargs nameserver)
-    if  [ -n "$namesrv" ] ; then
-        for s in $namesrv; do
-            echo nameserver $s
-        done
-    fi >> /tmp/net.$netif.resolv.conf
 }
 
 # loopback is always handled the same way
@@ -220,6 +206,14 @@ if [ "$netif" = "$vlanname" ] && [ ! -e /tmp/net.$vlanname.up ]; then
     ip link add dev "$vlanname" link "$phydevice" type vlan id "$(get_vid $vlanname; echo $?)"
 fi
 
+# setup nameserver
+namesrv=$(getargs nameserver)
+if  [ -n "$namesrv" ] ; then
+    for s in $namesrv; do
+        echo nameserver $s
+    done
+fi >> /tmp/net.$netif.resolv.conf
+
 # No ip lines default to dhcp
 ip=$(getarg ip)
 
