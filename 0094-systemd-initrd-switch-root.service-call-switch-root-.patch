From 3780d7e44982b0e801622f5ad90ce0e80792b69e Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Tue, 17 Jul 2012 11:09:17 +0200
Subject: [PATCH] systemd/initrd-switch-root.service: call switch-root with
 --no-block

---
 modules.d/98systemd/initrd-switch-root.service |    3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/modules.d/98systemd/initrd-switch-root.service b/modules.d/98systemd/initrd-switch-root.service
index 7b59e15..7d1a648 100644
--- a/modules.d/98systemd/initrd-switch-root.service
+++ b/modules.d/98systemd/initrd-switch-root.service
@@ -11,12 +11,13 @@ DefaultDependencies=no
 ConditionPathExists=/etc/initrd-release
 OnFailure=emergency.service
 After=initrd-switch-root.target
+AllowIsolate=yes
 
 [Service]
 Type=oneshot
 EnvironmentFile=/run/initramfs/switch-root.conf
 # we have to use "--force" here, otherwise systemd would umount /run
-ExecStart=/usr/bin/systemctl --force switch-root ${NEWROOT} ${NEWINIT}
+ExecStart=-/usr/bin/systemctl --no-block --force switch-root ${NEWROOT} ${NEWINIT}
 ExecStopPost=-/bin/rm -f /run/initramfs/switch-root.conf
 StandardInput=null
 StandardOutput=null
