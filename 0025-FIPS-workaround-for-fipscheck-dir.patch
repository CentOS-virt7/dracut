From 00083a0909130cc47e4ad876f0151509f4acf016 Mon Sep 17 00:00:00 2001
From: Milan Broz <mbroz@redhat.com>
Date: Fri, 24 Aug 2012 13:31:57 +0200
Subject: [PATCH] FIPS workaround for fipscheck dir

Also patch old install path... (used in Fedora 17)

Signed-off-by: Milan Broz <mbroz@redhat.com>
---
 dracut-functions.sh | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/dracut-functions.sh b/dracut-functions.sh
index c328f9f..d089b7f 100755
--- a/dracut-functions.sh
+++ b/dracut-functions.sh
@@ -620,6 +620,12 @@ else
             if [[ -e "${_src%/*}/.${_src##*/}.hmac" ]]; then
                 inst "${_src%/*}/.${_src##*/}.hmac" "${_target%/*}/.${_target##*/}.hmac"
             fi
+            if [[ -e "/lib/fipscheck/${_src##*/}.hmac" ]]; then
+                inst "/lib/fipscheck/${_src##*/}.hmac" "/lib/fipscheck/${_target##*/}.hmac"
+            fi
+            if [[ -e "/lib64/fipscheck/${_src##*/}.hmac" ]]; then
+                inst "/lib64/fipscheck/${_src##*/}.hmac" "/lib64/fipscheck/${_target##*/}.hmac"
+            fi
         fi
         ddebug "Installing $_src"
         cp --reflink=auto --sparse=auto -pfL "$_src" "${initdir}/$_target"
@@ -657,6 +663,12 @@ else
                 if [[ -e "${_src%/*}/.${_src##*/}.hmac" ]]; then
                     inst "${_src%/*}/.${_src##*/}.hmac" "${_dest%/*}/.${_dest##*/}.hmac"
                 fi
+                if [[ -e "/lib/fipscheck/${_src##*/}.hmac" ]]; then
+                    inst "/lib/fipscheck/${_src##*/}.hmac" "/lib/fipscheck/${_dest##*/}.hmac"
+                fi
+                if [[ -e "/lib64/fipscheck/${_src##*/}.hmac" ]]; then
+                    inst "/lib64/fipscheck/${_src##*/}.hmac" "/lib64/fipscheck/${_dest##*/}.hmac"
+                fi
             fi
             _reallib=$(readlink -f "$_src")
             inst_simple "$_reallib" "$_reallib"
