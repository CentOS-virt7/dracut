From 09ee7234b60354a446070b2d4f0df480e3684e6a Mon Sep 17 00:00:00 2001
From: Colin Guthrie <colin@mageia.org>
Date: Sun, 8 Jan 2012 21:32:05 +0000
Subject: [PATCH] dmsquash: Ensure the 'loop' kernel module is included and
 loaded.

---
 modules.d/90dmsquash-live/module-setup.sh        |    2 +-
 modules.d/90dmsquash-live/parse-dmsquash-live.sh |    2 ++
 2 files changed, 3 insertions(+), 1 deletions(-)

diff --git a/modules.d/90dmsquash-live/module-setup.sh b/modules.d/90dmsquash-live/module-setup.sh
index de1eed6..2a7988a 100755
--- a/modules.d/90dmsquash-live/module-setup.sh
+++ b/modules.d/90dmsquash-live/module-setup.sh
@@ -16,7 +16,7 @@ depends() {
 }
 
 installkernel() {
-    instmods squashfs
+    instmods squashfs loop
 }
 
 install() {
diff --git a/modules.d/90dmsquash-live/parse-dmsquash-live.sh b/modules.d/90dmsquash-live/parse-dmsquash-live.sh
index a733144..920647e 100755
--- a/modules.d/90dmsquash-live/parse-dmsquash-live.sh
+++ b/modules.d/90dmsquash-live/parse-dmsquash-live.sh
@@ -17,6 +17,8 @@ fi
 
 [ "${liveroot%%:*}" = "live" ] || return
 
+modprobe -q loop
+
 case "$liveroot" in
     live:LABEL=*|LABEL=*) \
         root="${root#live:}"
