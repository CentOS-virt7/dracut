From 04b873598b649913fcb9f303bd79ee5e1868f074 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Fri, 8 Feb 2013 14:19:19 +0100
Subject: [PATCH] systemd: set udev debug/info via config file and report
 obsolete options

---
 modules.d/98systemd/dracut-cmdline.sh     | 3 +++
 modules.d/98systemd/dracut-pre-trigger.sh | 3 ---
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/modules.d/98systemd/dracut-cmdline.sh b/modules.d/98systemd/dracut-cmdline.sh
index c32d5df..cec1b64 100755
--- a/modules.d/98systemd/dracut-cmdline.sh
+++ b/modules.d/98systemd/dracut-cmdline.sh
@@ -17,6 +17,9 @@ type getarg >/dev/null 2>&1 || . /lib/dracut-lib.sh
 [ -f /etc/initrd-release ] && . /etc/initrd-release
 [ -n "$VERSION" ] && info "dracut-$VERSION"
 
+getargbool 0 rd.udev.log-priority=info -d rd.udev.info -d -n -y rdudevinfo && echo 'udev_log="info"' >> /etc/udev/udev.conf
+getargbool 0 rd.udev.log-priority=debug -d rd.udev.debug -d -n -y rdudevdebug && echo 'udev_log="debug"' >> /etc/udev/udev.conf
+
 source_conf /etc/conf.d
 
 make_trace_mem "hook cmdline" '1+:mem' '1+:iomem' '3+:slab'
diff --git a/modules.d/98systemd/dracut-pre-trigger.sh b/modules.d/98systemd/dracut-pre-trigger.sh
index 35b0c5f..4685c8f 100755
--- a/modules.d/98systemd/dracut-pre-trigger.sh
+++ b/modules.d/98systemd/dracut-pre-trigger.sh
@@ -11,9 +11,6 @@ type getarg >/dev/null 2>&1 || . /lib/dracut-lib.sh
 source_conf /etc/conf.d
 
 make_trace_mem "hook pre-trigger" "1:shortmem" "2+:mem" "3+:slab"
-getargbool 0 rd.udev.info -n -y rdudevinfo && udevadm control --log-priority=info
-getargbool 0 rd.udev.debug -n -y rdudevdebug && udevadm control --log-priority=debug
-udevproperty "hookdir=$hookdir"
 
 source_hook pre-trigger
 
