From e6bec9b793314d248085e7dd50d9d79d9a01486e Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Thu, 12 Jul 2012 08:56:17 +0200
Subject: [PATCH] systemd/initrd-switch-root.service: add some more
 dependencies

---
 modules.d/98systemd/initrd-switch-root.service |    4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/modules.d/98systemd/initrd-switch-root.service b/modules.d/98systemd/initrd-switch-root.service
index e38f04d..f9fd10b 100644
--- a/modules.d/98systemd/initrd-switch-root.service
+++ b/modules.d/98systemd/initrd-switch-root.service
@@ -12,14 +12,14 @@ ConditionPathExists=/etc/initrd-release
 OnFailure=emergency.service
 After=initrd-switch-root.target
 Before=systemd-journal-flush.service
+Before=sysinit.target local-fs.target swap.target emergency.service emergency.target
 
 [Service]
 Type=oneshot
 EnvironmentFile=/run/initramfs/switch-root.conf
 # we have to use "--force" here, otherwise systemd would umount /run
 ExecStart=/usr/bin/systemctl --force switch-root ${NEWROOT} ${NEWINIT}
-ExecStopPost=-/usr/bin/systemctl stop systemd-journald.service
-ExecStopPost=-/bin/rm -f /run/initramfs/switch-root.conf
+ExecStopPost=-/usr/bin/systemctl stop systemd-journald.service ; /bin/rm -f /run/initramfs/switch-root.conf
 StandardInput=null
 StandardOutput=null
 StandardError=null
