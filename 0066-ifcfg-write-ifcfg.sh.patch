From 6625c085aeee0694f4f53b0454ff3466755d90a8 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Wed, 29 May 2013 14:38:52 +0200
Subject: [PATCH] ifcfg/write-ifcfg.sh:

- fix ONBOOT for slaves
- set TYPE=Bond for bonding

https://bugzilla.redhat.com/show_bug.cgi?id=919001
---
 modules.d/45ifcfg/write-ifcfg.sh | 12 +++++-------
 1 file changed, 5 insertions(+), 7 deletions(-)

diff --git a/modules.d/45ifcfg/write-ifcfg.sh b/modules.d/45ifcfg/write-ifcfg.sh
index baa63fa..625d00b 100755
--- a/modules.d/45ifcfg/write-ifcfg.sh
+++ b/modules.d/45ifcfg/write-ifcfg.sh
@@ -163,16 +163,16 @@ for netif in $IFACES ; do
             # This variable is an indicator of a bond interface for initscripts
             echo "BONDING_OPTS=\"$bondoptions\""
             echo "NAME=\"$netif\""
+            echo "TYPE=Bond"
         } >> /tmp/ifcfg/ifcfg-$netif
 
         for slave in $bondslaves ; do
-            # Set ONBOOT=no to prevent initscripts from trying to setup already bonded physical interface
             # write separate ifcfg file for the raw eth interface
             {
                 echo "# Generated by dracut initrd"
                 echo "DEVICE=$slave"
                 echo "TYPE=Ethernet"
-                echo "ONBOOT=no"
+                echo "ONBOOT=yes"
                 echo "NETBOOT=yes"
                 echo "HWADDR=$(cat /sys/class/net/$slave/address)"
                 echo "SLAVE=yes"
@@ -190,10 +190,9 @@ for netif in $IFACES ; do
         } >> /tmp/ifcfg/ifcfg-$netif
         if [ "$ethname" = "$bondname" ] ; then
             {
-                # Set ONBOOT=no to prevent initscripts from trying to setup already bridged bond interface
                 echo "# Generated by dracut initrd"
                 echo "DEVICE=$bondname"
-                echo "ONBOOT=no"
+                echo "ONBOOT=yes"
                 echo "NETBOOT=yes"
                 # This variable is an indicator of a bond interface for initscripts
                 echo "BONDING_OPTS=\"$bondoptions\""
@@ -202,12 +201,11 @@ for netif in $IFACES ; do
             } >> /tmp/ifcfg/ifcfg-$bondname
             for slave in $bondslaves ; do
                 # write separate ifcfg file for the raw eth interface
-                # Set ONBOOT=no to prevent initscripts from trying to setup already bridged physical interface
                 {
                     echo "# Generated by dracut initrd"
                     echo "DEVICE=$slave"
                     echo "TYPE=Ethernet"
-                    echo "ONBOOT=no"
+                    echo "ONBOOT=yes"
                     echo "NETBOOT=yes"
                     echo "HWADDR=$(cat /sys/class/net/$slave/address)"
                     echo "SLAVE=yes"
@@ -221,7 +219,7 @@ for netif in $IFACES ; do
                 echo "# Generated by dracut initrd"
                 echo "DEVICE=$ethname"
                 echo "TYPE=Ethernet"
-                echo "ONBOOT=no"
+                echo "ONBOOT=yes"
                 echo "NETBOOT=yes"
                 echo "HWADDR=$(cat /sys/class/net/$ethname/address)"
                 echo "BRIDGE=$netif"
