From 5d833a9f5bf16a5787b164b7a1f17f98cac13732 Mon Sep 17 00:00:00 2001
From: Harald Hoyer <harald@redhat.com>
Date: Fri, 27 Jul 2012 15:11:01 +0200
Subject: [PATCH] add "af_packet" kernel module to network testsuite tests

---
 test/TEST-20-NFS/test.sh      | 4 ++--
 test/TEST-30-ISCSI/test.sh    | 4 ++--
 test/TEST-40-NBD/test.sh      | 4 ++--
 test/TEST-50-MULTINIC/test.sh | 4 ++--
 4 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/test/TEST-20-NFS/test.sh b/test/TEST-20-NFS/test.sh
index a44f6c0..c7ccc09 100755
--- a/test/TEST-20-NFS/test.sh
+++ b/test/TEST-20-NFS/test.sh
@@ -336,14 +336,14 @@ test_setup() {
     # Make server's dracut image
     $basedir/dracut.sh -l -i $TESTDIR/overlay / \
 	-m "dash udev-rules base rootfs-block debug kernel-modules watchdog" \
-	-d "piix ide-gd_mod ata_piix ext3 sd_mod e1000 ib700wdt" \
+	-d "af_packet piix ide-gd_mod ata_piix ext3 sd_mod e1000 ib700wdt" \
 	-f $TESTDIR/initramfs.server $KVERSION || return 1
 
     # Make client's dracut image
     $basedir/dracut.sh -l -i $TESTDIR/overlay / \
 	-o "plymouth" \
 	-a "debug watchdog" \
-	-d "piix ide-gd_mod ata_piix sd_mod e1000 nfs sunrpc ib700wdt" \
+	-d "af_packet piix ide-gd_mod ata_piix sd_mod e1000 nfs sunrpc ib700wdt" \
 	-f $TESTDIR/initramfs.testing $KVERSION || return 1
 }
 
diff --git a/test/TEST-30-ISCSI/test.sh b/test/TEST-30-ISCSI/test.sh
index 1b1924b..c3d2c39 100755
--- a/test/TEST-30-ISCSI/test.sh
+++ b/test/TEST-30-ISCSI/test.sh
@@ -162,7 +162,7 @@ test_setup() {
     sudo $basedir/dracut.sh -l -i $TESTDIR/overlay / \
         -o "plymouth dmraid" \
         -a "debug" \
-        -d "piix ide-gd_mod ata_piix ext3 sd_mod" \
+        -d "af_packet piix ide-gd_mod ata_piix ext3 sd_mod" \
         -f $TESTDIR/initramfs.testing $KVERSION || return 1
 
     # Make server root
@@ -211,7 +211,7 @@ test_setup() {
     # Make server's dracut image
     $basedir/dracut.sh -l -i $TESTDIR/overlay / \
         -m "dash udev-rules base rootfs-block debug kernel-modules" \
-        -d "piix ide-gd_mod ata_piix ext3 sd_mod e1000" \
+        -d "af_packet piix ide-gd_mod ata_piix ext3 sd_mod e1000" \
         -f $TESTDIR/initramfs.server $KVERSION || return 1
 
 }
diff --git a/test/TEST-40-NBD/test.sh b/test/TEST-40-NBD/test.sh
index 94efb8a..99d930f 100755
--- a/test/TEST-40-NBD/test.sh
+++ b/test/TEST-40-NBD/test.sh
@@ -333,13 +333,13 @@ test_setup() {
 
     sudo $basedir/dracut.sh -l -i $TESTDIR/overlay / \
 	-m "dash udev-rules rootfs-block base debug kernel-modules" \
-	-d "piix ide-gd_mod ata_piix ext2 ext3 sd_mod e1000" \
+	-d "af_packet piix ide-gd_mod ata_piix ext2 ext3 sd_mod e1000" \
 	-f $TESTDIR/initramfs.server $KVERSION || return 1
 
     sudo $basedir/dracut.sh -l -i $TESTDIR/overlay / \
 	-o "plymouth" \
 	-a "debug watchdog" \
-	-d "piix ide-gd_mod ata_piix ext2 ext3 sd_mod e1000 ib700wdt" \
+	-d "af_packet piix ide-gd_mod ata_piix ext2 ext3 sd_mod e1000 ib700wdt" \
 	-f $TESTDIR/initramfs.testing $KVERSION || return 1
 }
 
diff --git a/test/TEST-50-MULTINIC/test.sh b/test/TEST-50-MULTINIC/test.sh
index 74f10d8..2125b8e 100755
--- a/test/TEST-50-MULTINIC/test.sh
+++ b/test/TEST-50-MULTINIC/test.sh
@@ -246,14 +246,14 @@ test_setup() {
     # Make server's dracut image
     $basedir/dracut.sh -l -i $TESTDIR/overlay / \
         -m "dash udev-rules base rootfs-block debug kernel-modules watchdog" \
-        -d "piix ide-gd_mod ata_piix ext3 sd_mod e1000 ib700wdt" \
+        -d "af_packet piix ide-gd_mod ata_piix ext3 sd_mod e1000 ib700wdt" \
         -f $TESTDIR/initramfs.server $KVERSION || return 1
 
     # Make client's dracut image
     $basedir/dracut.sh -l -i $TESTDIR/overlay / \
         -o "plymouth" \
         -a "debug" \
-        -d "piix sd_mod sr_mod ata_piix ide-gd_mod e1000 nfs sunrpc ib700wdt" \
+        -d "af_packet piix sd_mod sr_mod ata_piix ide-gd_mod e1000 nfs sunrpc ib700wdt" \
         -f $TESTDIR/initramfs.testing $KVERSION || return 1
 }
 
